<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Lib_xemngaytheotuoi{

	public $dl_thongthu  = array(
									'1'  => array(//thang (am lich)
													'5' => array(//chi ngay ( vd 1: tys)
															'congviec'    => '0,2,3,4,10,11,12,13,14,15,16,17,23,24,31,32,33',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,2,10,16,17,21,24,32,33',
															'phanloai'    => 0 
														),
													'8' => array(
															'congviec'    => '0,2,3,4,9,10,11,12,13,19,20,21,23,24,31,32,33',
															'phanloai'    =>  1
														),
												),
									'2'  => array(
													'3' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20',
															'phanloai'    => 1 
														),
													'4' => array(
															'congviec'    => '0,22,23,24,32',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,2,10,11,12,13,15,16,17,24,32',
															'phanloai'    => 0 
														),
													'7' => array(
															'congviec'    => '0,2,5,6,7,8,9,10,11,12,13,14,16,18,19,20,22,23,24,32',
															'phanloai'    => 1
														),
													'8' => array(
															'congviec'    => '0,6,7,10,11,16,33',
															'phanloai'    => 1 
														),
													'9' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,9,10,11,12,13,14,18,24,33',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,2,10,11,15,16,17,18,22,24',
															'phanloai'    => 0 
														),
												),
									'3'  => array(

													'1' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,11,12,13,14,15,24,26',
															'phanloai'    => 0 
														),
													'3' => array(
															'congviec'    => '0,1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,24,31',
															'phanloai'    =>  1
														),
													'4' => array(
															'congviec'    => '0,6,7,8,10,11,12,13,14,18,22,23,24',
															'phanloai'    => 0 
														),
													'5' => array(
															'congviec'    => '0,2,3,10,11,12,13,14,16,17,18',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,2,3,4,8,10,11,12,13,14,15,16,17,18,26,33',
															'phanloai'    => 1 
														),
													'9' => array(
															'congviec'    => '0,2,3,8,10,11,12,13,24,33',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20',
															'phanloai'    => 1
														),
													'11' => array(
															'congviec'    => '0,11,12,13,14,18,24',
															'phanloai'    => 0 
														),
												),
									'4'  => array(

													'2' => array(
															'congviec'    => '0,1,2,3,5,6,7,9,11,14,15,16,17,18,32,33',
															'phanloai'    => 1 
														),
													'5' => array(
															'congviec'    => '0,2,10,22,23,24',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,2,8,10,11,12,13,14,15,16,17,18,19,20,24',
															'phanloai'    => 1 
														),
													'8' => array(
															'congviec'    => '0,2,8,11,13,15,16,17,24,30',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,1,2,5,6,7,8,9,10,11,12,13,16,17,24',
															'phanloai'    => 0 
														),
													'11' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,15,16,17,24,25,26,29',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,2,10,11,13,24,33',
															'phanloai'    => 1 
														),
												),
									'5'  => array(
													'3' => array(
															'congviec'    => '0,2,10,14,16,17,18,22,23,24,32,33',
															'phanloai'    => 0 
														),
													'5' => array(
															'congviec'    => '0,1,2,5,6,7,8,10,11,13,14,16,17,18,19,20,21,22,23,24',
															'phanloai'    => 0 
														),
													'6' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,11,12,13,14,15,16,17,18,22,23,24',
															'phanloai'    => 0 
														),
													'8' => array(
															'congviec'    => '0,1,2,3,5,6,7,11,12,13,14,15,16,17,18,22,23,24',
															'phanloai'    => 0 
														),
													'10' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,2',
															'phanloai'    => 1 
														),
												),
									'6'  => array(

													'1' => array(
															'congviec'    => '0,2,10,24,32,33',
															'phanloai'    => 1 
														),
													'3' => array(
															'congviec'    => '0,2,3,14,15,16,17,18,22,23,24',
															'phanloai'    => 1 
														),
													'4' => array(
															'congviec'    => '0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21',
															'phanloai'    =>  1
														),
													'6' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,24',
															'phanloai'    => 1
														),
													'9' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,24',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,10,11,13,15,16,17,22,23',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,10,22,23',
															'phanloai'    => 1 
														),
												),
									'7'  => array(
													'5' => array(
															'congviec'    => '0,5,6,7,8,9,10,11,12,13,15,16,17,19,20,21,24,33',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,2,11,13,15,16,17,24',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,13,15,16,17,24',
															'phanloai'    => 0 
														),
													'8' => array(
															'congviec'    => '0,10,13,24,32,33',
															'phanloai'    => 1 
														),
													'11' => array(
															'congviec'    => '0,1,2,13,14,15,16,17,22,23',
															'phanloai'    => 1 
														),
												),
									'8'  => array(

													'1' => array(
															'congviec'    => '0,10,13,14,24',
															'phanloai'    => 1 
														),
													'3' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,1,2,5,6,7,9,10,11,12,13,14,15,16,17,18',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,24',
															'phanloai'    => 1 
														),
													'9' => array(
															'congviec'    => '0,2,3,10,11,12,13,14,15,16,17,18,22,23,24',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,10,11,13,14,16,17,24',
															'phanloai'    => 1 
														),
												),
									'9'  => array(
													'5' => array(
															'congviec'    => '0,2,10,13,14,16,17,24,26',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,1,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,26',
															'phanloai'    => 1 
														),
													'9' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,24,26',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,8,11,12,13,15,16,17,24',
															'phanloai'    => 1 
														),
													'11' => array(
															'congviec'    => '0,2,12,13,14,18,22,23,24,26',
															'phanloai'    => 0 
														),
													'12' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,18,19,21,22,23,24',
															'phanloai'    => 1 
														),
												),
									'10' => array(
													'1' => array(
															'congviec'    => '0,2,5,6,7,8,9,10,14,15,16,17,18,24',
															'phanloai'    => 0 
														),
													'5' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,1,2,5,6,7,9,21,22,32',
															'phanloai'    => 0 
														),

													'8' => array(
															'congviec'    => '0,1,2,3,6,7,9,10,11,13,14,15,16,17,31,32',
															'phanloai'    => 1 
														),
													'11' => array(
															'congviec'    => '0,2,10,24,26',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,2,9,10,11,12,13,14,15,16,17,18,24,32,33',
															'phanloai'    => 1 
														),
												),
									'11' => array(
													
													'1' => array(
															'congviec'    => '0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,2',
															'phanloai'    => 1 
														),
													'2' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20',
															'phanloai'    => 1 
														),
													'5' => array(
															'congviec'    => '0,2,10,11,13,14,24,32,33',
															'phanloai'    => 0 
														),
													'6' => array(
															'congviec'    => '0,10,11,13,14,15,24,26,32,33',
															'phanloai'    => 0 
														),
													'7' => array(
															'congviec'    => '0,10,11,12,13,14,22,23,24,32,33',
															'phanloai'    => 0 
														),
													'9' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,2',
															'phanloai'    => 1 
														),
													'10' => array(
															'congviec'    => '0,2,7,10,15,16,17,26',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,9,10,11,12,13,14,15,16,17,18,19,20,2',
															'phanloai'    => 0 
														),
												),
									'12' => array(
													'1' => array(
															'congviec'    => '0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,19,20',
															'phanloai'    => 0 
														),
													'3' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23,2',
															'phanloai'    => 1 
														),
													'4' => array(
															'congviec'    => '0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,22,23',
															'phanloai'    => 1 
														),
													'6' => array(
															'congviec'    => '0,2,10,11,13,14,16,24',
															'phanloai'    => 1 
														),
													'7' => array(
															'congviec'    => '0,19,20,21,24',
															'phanloai'    => 0 
														),
													'8' => array(
															'congviec'    => '0,19,20,21,22,23,24',
															'phanloai'    => 0 
														),
													'11' => array(
															'congviec'    => '0,2,3,7,10,11,12,13,14,15,16,17,18,24,26',
															'phanloai'    => 1 
														),
													'12' => array(
															'congviec'    => '0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,2',
															'phanloai'    => 1 
														),
												),
								);

	public $dl_nhithapbattu = array(
									'1'  => array(
												'congviectot'  => '0,1,22,23',
												'congviecxau'  => '19,20,21',
												'phanloai'     => 1
											),
									'2'  => array(
												'congviectot'  => '0',
												'congviecxau'  => '1,12,13,14,15',
												'phanloai'     => 0
											),
									'3'  => array(
												'congviectot'  => '0',
												'congviecxau'  => '1,4,15,22',
												'phanloai'     => 0
											),
									'4'	=>  array(
												'congviectot'  => '0,1,4,8,16,17,19,20,21,22',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'5' =>  array(
												'congviectot'  => '0',
												'congviecxau'  => '1,4,15,29',
												'phanloai'     => 0
											),
									'6' =>	array(
												'congviectot'  => '0,1,2,3,4,19,20,21,30,31',
												'congviecxau'  => '29',
												'phanloai'     => 1
											),
									'7' =>	array(
												'congviectot'  => '0,15,19,20,21,22,30,31',
												'congviecxau'  => '29',
												'phanloai'     => 1
											),
									'8' =>	array(
												'congviectot'  => '1,4,8,15,19,20,21,26,30,31',
												'congviecxau'  => '',
												'phanloai'     =>1 
											),
									'9' =>	array(
												'congviectot'  => '0',
												'congviecxau'  => '1,4,15,22,30,31',
												'phanloai'     => 0
											),
									'10'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '15,19,20,21,30,31',
												'phanloai'     => 0
											),
									'11'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '1,4,15,30,31',
												'phanloai'     => 0
											),
									'12'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '3,4,15,20,30,31',
												'phanloai'     => 0
											),
									'13'=>	array(
												'congviectot'  => '1,4,8,9,19,20,21,30',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'14'=>	array(
												'congviectot'  => '0,1,3,4,15,19,20,21,30,31',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'15'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '4,15,19,20,21,29,30,31',
												'phanloai'     => 0
											),
									'16'=>	array(
												'congviectot'  => '0,1,8,30,31',
												'congviecxau'  => '29',
												'phanloai'     => 1
											),
									'17'=>	array(
												'congviectot'  => '0,1,4,19,20,21',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'18'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '1,19,20,21,22,26,29,30,31',
												'phanloai'     => 0
											),
									'19'=>	array(
												'congviectot'  => '0,1,19,20,21,22,29,31',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'20'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '19,20,21',
												'phanloai'     => 0
											),
									'21'=>	array(
												'congviectot'  => '0,4,9,30,31',
												'congviecxau'  => '1,29',
												'phanloai'     => 1
											),
									'22'=>	array(
												'congviectot'  => '0,1,3,4,8,26,30,31',
												'congviecxau'  => '19,20,21',
												'phanloai'     => 1
											),
									'23'=>	array(
												'congviectot'  => '0,19,20,21',
												'congviecxau'  => '1,3,4,30,31',
												'phanloai'     => 0
											),
									'24'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '4,19,20,21,30,31',
												'phanloai'     => 0
											),
									'25'=>	array(
												'congviectot'  => '0,4',
												'congviecxau'  => '1,19,20,21,30',
												'phanloai'     => 0
											),
									'26'=>	array(
												'congviectot'  => '0,1,3,4,15,19,20,21,30,31',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
									'27'=>	array(
												'congviectot'  => '0',
												'congviecxau'  => '1,3,4,19,20,21,30,31',
												'phanloai'     => 0
											),
									'28'=>	array(
												'congviectot'  => '0,1,4,8,15,19,20,21,22',
												'congviecxau'  => '',
												'phanloai'     => 1
											),
								);

	public $dl_ngaycanchi   = array(
									'3' => '1,5,6,10,12,15,20,21,22,23,27,30,32,36,38,40,41,42,45,48,49,51,52',
									'4' => '1,10,15,16,17,18,21,25,31,33,35,36,37,41,50',
									'6' => '1,2,3,5,7,14,15,22,27,29,30,32,39,40,41,43,48,50,53,54,59',
									'8' => '1,3,4,5,6,7,12,13,16,19,21,22,23,25,30,36,37,39,43,45,47,48,49,50,57,58',
									'11' => '8,13,14,19,20,21,28,29,32,37,40,44,45,49,51,52,56,58',
									'12' => '4,8,13,19,20,21,28,29,32,37,40,44,45,49,51,52,58',
									'17' => '6,8,12,19,27,29,31,32,44,53,54',
									'15' => '1,2,3,6,7,8,11,12,13,19,20,21,27,28,32,36,37,40,43,49,51,52,56,57,58',
									'18' => '12,22,23,29,42,49,56',
									'19' => '9,10,19,21,22,33,34,39,43,46,57,58',
									'22' => '1,2,3,4,7,8,11,12,14,16,21,25,27,28,31,37,38,39,40,43,44,46,52,57',
									'27' => '18,19,22,29,31,32,43,53,55',
									'28' => '1,2,7,19,43,49,53',
									'29' => '1,2,3,4,6,7,8,11,13,14,17,18,22,23,25,26,30,34,35,36,37,39,40,41,42,43,51,52,53,54,55,56,58,59',
									'30' => '1,2,10,31,37,38,39,48,58',
									'33' => '3,6,8,15,16,21,22,49,51,52,56,57',
								);

	public $xd_giohoangdao = array(
                                        '3,1'=>'1',
                                        '3,2'=>'1',
                                        '3,3'=>'2',
                                        '3,4'=>'2',
                                        '3,5'=>'1',
                                        '3,6'=>'1',
                                        '3,7'=>'2',
                                        '3,8'=>'1',
                                        '3,9'=>'2',
                                        '3,10'=>'2',
                                        '3,11'=>'1',
                                        '3,12'=>'2',
                                        '4,1'=>'1',
                                        '4,2'=>'2',
                                        '4,3'=>'1',
                                        '4,4'=>'1',
                                        '4,5'=>'2',
                                        '4,6'=>'2',
                                        '4,7'=>'1',
                                        '4,8'=>'1',
                                        '4,9'=>'2',
                                        '4,10'=>'1',
                                        '4,11'=>'2',
                                        '4,12'=>'2',
                                        '5,1'=>'2',
                                        '5,2'=>'2',
                                        '5,3'=>'1',
                                        '5,4'=>'2',
                                        '5,5'=>'1',
                                        '5,6'=>'1',
                                        '5,7'=>'2',
                                        '5,8'=>'2',
                                        '5,9'=>'1',
                                        '5,10'=>'1',
                                        '5,11'=>'2',
                                        '5,12'=>'1',
                                        '6,1'=>'2',
                                        '6,2'=>'1',
                                        '6,3'=>'2',
                                        '6,4'=>'2',
                                        '6,5'=>'1',
                                        '6,6'=>'2',
                                        '6,7'=>'1',
                                        '6,8'=>'1',
                                        '6,9'=>'2',
                                        '6,10'=>'2',
                                        '6,11'=>'1',
                                        '6,12'=>'1',
                                        '7,1'=>'1',
                                        '7,2'=>'1',
                                        '7,3'=>'2',
                                        '7,4'=>'1',
                                        '7,5'=>'2',
                                        '7,6'=>'2',
                                        '7,7'=>'1',
                                        '7,8'=>'2',
                                        '7,9'=>'1',
                                        '7,10'=>'1',
                                        '7,11'=>'2',
                                        '7,12'=>'2',
                                        '8,1'=>'2',
                                        '8,2'=>'2',
                                        '8,3'=>'1',
                                        '8,4'=>'1',
                                        '8,5'=>'2',
                                        '8,6'=>'1',
                                        '8,7'=>'2',
                                        '8,8'=>'2',
                                        '8,9'=>'1',
                                        '8,10'=>'2',
                                        '8,11'=>'1',
                                        '8,12'=>'1',
                                        '9,1'=>'1',
                                        '9,2'=>'1',
                                        '9,3'=>'2',
                                        '9,4'=>'2',
                                        '9,5'=>'1',
                                        '9,6'=>'1',
                                        '9,7'=>'2',
                                        '9,8'=>'1',
                                        '9,9'=>'2',
                                        '9,10'=>'2',
                                        '9,11'=>'1',
                                        '9,12'=>'2',
                                        '10,1'=>'1',
                                        '10,2'=>'2',
                                        '10,3'=>'1',
                                        '10,4'=>'1',
                                        '10,5'=>'2',
                                        '10,6'=>'2',
                                        '10,7'=>'1',
                                        '10,8'=>'1',
                                        '10,9'=>'2',
                                        '10,10'=>'1',
                                        '10,11'=>'2',
                                        '10,12'=>'2',
                                        '11,1'=>'2',
                                        '11,2'=>'2',
                                        '11,3'=>'1',
                                        '11,4'=>'2',
                                        '11,5'=>'1',
                                        '11,6'=>'1',
                                        '11,7'=>'2',
                                        '11,8'=>'2',
                                        '11,9'=>'1',
                                        '11,10'=>'1',
                                        '11,11'=>'2',
                                        '11,12'=>'1',
                                        '12,1'=>'2',
                                        '12,2'=>'1',
                                        '12,3'=>'2',
                                        '12,4'=>'2',
                                        '12,5'=>'1',
                                        '12,6'=>'2',
                                        '12,7'=>'1',
                                        '12,8'=>'1',
                                        '12,9'=>'2',
                                        '12,10'=>'2',
                                        '12,11'=>'1',
                                        '12,12'=>'1',
                                        '1,1'=>'1',
                                        '1,2'=>'1',
                                        '1,3'=>'2',
                                        '1,4'=>'1',
                                        '1,5'=>'2',
                                        '1,6'=>'2',
                                        '1,7'=>'1',
                                        '1,8'=>'2',
                                        '1,9'=>'1',
                                        '1,10'=>'1',
                                        '1,11'=>'2',
                                        '1,12'=>'2',
                                        '2,1'=>'2',
                                        '2,2'=>'2',
                                        '2,3'=>'1',
                                        '2,4'=>'1',
                                        '2,5'=>'2',
                                        '2,6'=>'1',
                                        '2,7'=>'2',
                                        '2,8'=>'2',
                                        '2,9'=>'1',
                                        '2,10'=>'2',
                                        '2,11'=>'1',
                                        '2,12'=>'1',
                                      );

	public $giohoangdao = array(
                                    '1'=>'Tí (23:00-0:59)',
                                    '2'=>'Sửu (1:00-2:59)',
                                    '3'=>'Dần (3:00-4:59)',
                                    '4'=>'Mão (5:00-6:59)',
                                    '5'=>'Thìn (7:00-8:59)',
                                    '6'=>'Tỵ (9:00-10:59)',
                                    '7'=>'Ngọ (11:00-12:59)',
                                    '8'=>'Mùi (13:00-14:59)',
                                    '9'=>'Thân (15:00-16:59)',
                                    '10'=>'Dậu (17:00-18:59)',
                                    '11'=>'Tuất (19:00-20:59)',
                                    '12'=>'Hợi (21:00-22:59)',
                               );

	public function __construct(){
        $this->CI =& get_instance();
        $this->CI->load->library('ngayamduong');
        $this->CI->load->database();
    }
    // Loaingay: thongthu, canchi : 0:binhthuong, 1: tot
    //           nhithapbattu     : 0:xau, 1:tot


    /** HAM TRA VE TEN SAO DUA THEO KEY/ DANH SACH 28 SAO NHI THAP BAT TU 
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    private function getNhithapbattu($key = null){
        $arr         = array(
                            '1'  => 'Giác',
                            '2'  => 'Cang',
                            '3'  => 'Dê',
                            '4'  => 'Phòng',
                            '5'  => 'Tâm',
                            '6'  => 'Vỹ',
                            '7'  => 'Cơ',
                            '8'  => 'Đẩu',
                            '9'  => 'Ngưu',
                            '10' => 'Nữ',
                            '11' => 'Hư',
                            '12' => 'Nguy',
                            '13' => 'Thất',
                            '14' => 'Bích',
                            '15' => 'Khuê',
                            '16' => 'Lâu',
                            '17' => 'Vỵ',
                            '18' => 'Mão',
                            '19' => 'Tất',
                            '20' => 'Chủy',
                            '21' => 'Sâm',
                            '22' => 'Tỉnh',
                            '23' => 'Quỷ',
                            '24' => 'Liễu',
                            '25' => 'Tinh',
                            '26' => 'Trương',
                            '27' => 'Dực',
                            '28' => 'Chẩn',
                          );
        if ( $key != null && ( 1 <= $key) && ( $key <= 28 ) ) {
          return $arr[$key];
        }else{
          return $arr;
        }
    }


    /** HAM TRA VE CHI(STRING)/ DANH SACH 12 CHI(12 CON GIAP) 
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    private function getChi($key = null){
      $arr         = array(
                            '1'  => 'Tý',
                            '2'  => 'Sửu',
                            '3'  => 'Dần',
                            '4'  => 'Mão',
                            '5'  => 'Thìn',
                            '6'  => 'Tỵ',
                            '7'  => 'Ngọ',
                            '8'  => 'Mùi',
                            '9'  => 'Thân',
                            '10' => 'Dậu',
                            '11' => 'Tuất',
                            '12' => 'Hợi',
                          );
        if ( $key != null && ( 1 <= $key) && ( $key <= 12 ) ) {
          return $arr[$key];
        }else{
          return $arr;
        }

    }

    /** HAM TRA VE CHI(NUMBER)/ CUNG CUA THANG AM LICH 
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    private function getCungThangAL($key = null){
      $arr         = array(
							1 => 3,
							2 => 4,
							3 => 5,
							4 => 6,
							5 => 7,
							6 => 8,
							7 => 9,
							8 => 10,
							9 => 11,
							10 => 12,
							11 => 1,
							12 => 2,
                          );
        if ( $key != null && ( 1 <= $key) && ( $key <= 12 ) ) {
          return $arr[$key];
        }else{
          return $arr;
        }

    }


    /** HAM TRA VE TEN HOA GIAP/ DANH SACH 60 HOA GIAP
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    private function getLucthaphoagiap($key = null){
        $arr         = array
                                        (
                                            1  => 'Giáp Tý',
                                            2  => 'Ất Sửu',
                                            3  => 'Bính Dần',
                                            4  => 'Đinh Mão',
                                            5  => 'Mậu Thìn',
                                            6  => 'Kỷ Tỵ',
                                            7  => 'Canh Ngọ',
                                            8  => 'Tân Mùi',
                                            9  => 'Nhâm Thân',
                                            10 => 'Quý Dậu',
                                            11 => 'Giáp Tuất',
                                            12 => 'Ất Hợi',
                                            13 => 'Bính Tý',
                                            14 => 'Đinh Sửu',
                                            15 => 'Mậu Dần',
                                            16 => 'Kỷ Mão',
                                            17 => 'Canh Thìn',
                                            18 => 'Tân Tỵ',
                                            19 => 'Nhâm Ngọ',
                                            20 => 'Quý Mùi',
                                            21 => 'Giáp Thân',
                                            22 => 'Ất Dậu',
                                            23 => 'Mậu Tý',
                                            24 => 'Kỷ Sửu',
                                            25 => 'Bính Tuất',
                                            26 => 'Đinh Hợi',
                                            27 => 'Canh Dần',
                                            28 => 'Tân Mão',
                                            29 => 'Nhâm Thìn',
                                            30 => 'Quý Tỵ',
                                            31 => 'Giáp Ngọ',
                                            32 => 'Ất Mùi',
                                            33 => 'Bính Thân',
                                            34 => 'Đinh Dậu',
                                            35 => 'Mậu Tuất',
                                            36 => 'Kỷ Hợi',
                                            37 => 'Canh Tý',
                                            38 => 'Tân Sửu',
                                            39 => 'Nhâm Dần',
                                            40 => 'Quý Mão',
                                            41 => 'Giáp Thìn',
                                            42 => 'Ất Tỵ',
                                            43 => 'Bính Ngọ',
                                            44 => 'Đinh Mùi',
                                            45 => 'Mậu Thân',
                                            46 => 'Kỷ Dậu',
                                            47 => 'Canh Tuất',
                                            48 => 'Tân Hợi',
                                            49 => 'Nhâm Tý',
                                            50 => 'Quý Sửu',
                                            51 => 'Giáp Dần',
                                            52 => 'Ất Mão',
                                            53 => 'Bính Thìn',
                                            54 => 'Đinh Tỵ',
                                            55 => 'Mậu Ngọ',
                                            56 => 'Kỷ Mùi',
                                            57 => 'Canh Thân',
                                            58 => 'Tân Dậu',
                                            59 => 'Nhâm Tuất',
                                            60 => 'Quý Hợi',
                                        );
            if ( $key != null && ( 1 <= $key) && ( $key <= 60 ) ) {
            	return $arr[$key];
            }else{
           		return $arr;
            }

        }


    /** HAM TRA VE TEN CONG VIEC/ DANH SACH CAC CONG VIEC HO TRO XEM NGAY
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    private function getCongviec($key = null){
      	$arr         = array(
      						'0'  => 'Xem ngày tốt xấu',
                            '1'  => 'Xem ngày cưới hỏi, dạm ngõ, đăng ký kết hôn',
                            '2'  => 'Xem ngày đổ trần, đổ sàn',
                            '3'  => 'Xem ngày lợp mái, cất nóc',
                            '4'  => 'Xem ngày động thổ, làm nhà',
                            '5'  => 'Xem ngày nhập trạch',
                            '6'  => 'Xem ngày chuyển nhà',
                            '7'  => 'Xem ngày chuyển văn phòng',
                            '8'  => 'Xem ngày chuyển việc, đi làm, nhậm chức',
                            '9'  => 'Xem ngày thành lập công ty',
                            '10' => 'Xem ngày chuyển bàn thờ, bốc bát hương, lập bàn thờ, mua bàn thờ',

                            '11' => 'Xem ngày mua nhà, mua đất',
                            '12' => 'Xem ngày giao dịch',
                            '13' => 'Xem ngày ký hợp đồng mua bán nhà đất',
                            '14' => 'Xem ngày ký hợp đồng mua bán xe hơi',
                            '15' => 'Xem ngày khai trương, mở cửa hàng, xem biển hiệu',
                            '16' => 'Xem ngày mua vàng',
                            '17' => 'Xem ngày mua két sắt, đặt két sắt',

                            '18' => 'Xem ngày mua xe, cúng xe mới',
                            '19' => 'Xem ngày bốc mộ, cải táng, an táng',
                            '20' => 'Xem ngày chôn cất người chết',
                            '21' => 'Xem ngày sửa mộ',
                            '22' => 'Xem ngày tốt xuất hành',
                            '23' => 'Xem ngày mua sắm',
                            '24' => 'Xem ngày tốt phẫu thuật thẩm mỹ',
                            '25' => 'Xem ngày cắt tóc',
                            '26' => 'Xem ngày tốt chăn nuôi, xây dựng chuồng trại',
                            '27' => 'Xem ngày tốt mua chó',
                            '28' => 'Xem ngày tốt mua mèo',
                            '29' => 'Xem ngày tốt lắp đặt giường',
                            '30' => 'Xem ngày đào giếng, khoan giếng',
                            '31' => 'Xem ngày sửa cổng, dựng cửa chính',
                            '32' => 'Xem ngày phá dỡ nhà',
                            '33' => 'Xem ngày sửa nhà, sửa bếp',
                          );
        if ( $key != null && ( 1 <= $key) && ( $key <= 33 ) ) {
          return $arr[$key];
        }else{
          return $arr;
        }

    }

    /** HAM XAC DINH GIO HOANG DAO **/
    public function xacdinh_giohoangdao($chingay){
        $rt = array();
            for( $i = 1; $i<= 12; $i++ ){
                $key = $chingay.','.$i;
                if( isset( $this->xd_giohoangdao[ $key ] ) ){
                    if( $this->xd_giohoangdao[ $key ] == 1 ){
                        $rt['hoang_dao'][] = $this->giohoangdao[ $i ];
                    }else{
                        $rt['hac_dao'][]   = $this->giohoangdao[ $i ];
                    }
                }
            }
        return $rt;
    }

    function tinhngay_nguyetki_tamnuong($ngayamlich)
	    {
	        $arr          = array(
		        					5,14,23,//nguyetky
		        					3,7,13,18,22,27//tamnuong
	        					);

	        if(in_array($ngayamlich,$arr))
	            return true;
	        return false;
	    }   

    function tinhngay_thutu($chingay,$thang)
	    {//thang am lich
	        $arr = array(
	            0 => array('none','none','none'),
	            1 => array('Tuất','Tỵ','Tý'),
	            2 => array('Thìn','Tý','Sửu'),
	            3 => array('Hợi','Mùi','Sửu'),
	            4 => array('Tỵ','Mão','Tuất'),
	            5 => array('Tý','Thân','Thìn'),
	            6 => array('Ngọ','Tuất','Thìn'),
	            7 => array('Sửu','Sửu','Sửu'),
	            8 => array('Mùi','Hợi','Thìn'),
	            9 => array('Dần','Ngọ','Sửu'),
	            10 => array('Thân','Dậu','Thìn'),
	            11 => array('Mão','Dần','Mùi'),
	            12 => array('Dậu','none','Thìn'),
	        );
	        $arr_thang = $arr[$thang];
	        if(in_array($chingay, $arr_thang))
	    		return true;
	        return false;
	        
	    }
    
    function tinhngay_trungtang_trungphuc($canngay, $thang)
	    {//thang am lich
	        $arr = array(
	            0 => array('none','none'),
	            1 => array('Giáp','Canh'),
	            2 => array('Ất','Tân'),
	            3 => array('Kỷ','Kỷ'),
	            4 => array('Bính','Nhâm'),
	            5 => array('Đinh','Quý'),
	            6 => array('Mậu','Mậu'),
	            7 => array('Canh','Giáp'),
	            8 => array('Kỷ','Ất'),
	            9 => array('Kỷ','Kỷ'),
	            10=> array('Nhâm','Nhâm'),
	            11=> array('Quý','Quý'),
	            12=> array('Kỷ','Kỷ'),
	        );
	        $arr_thang = $arr[$thang];
	        if (in_array($canngay, $arr_thang))
	        	return true;
	        return false;
	    }
    
    function tinhngay_duongcongluy($ngay,$thang)
	    {// thang am lich
	        $arr = array(
	            0 => array('none','none'),
	            1 => array(13),
	            2 => array(11),
	            3 => array(9),
	            4 => array(7),
	            5 => array(5),
	            6 => array(3),
	            7 => array(1,29),
	            8 => array(27),
	            9 => array(25),
	            10 => array(23),
	            11 => array(21),
	            12 => array(19),
	        );
	        $arr_thang = $arr[$thang];
	        if(in_array($ngay,$arr_thang))
	            return true;
	        return false;
	    }
    
    function tinhngay_kimthanthatsat($chingay,$cannam)
	    {
	        $arr = array(
	        	0      => array('none', 'none'),
	            'Giáp' => array('Ngọ','Mùi'),
	            'Ất'   => array('Thìn', 'Tỵ'),
	            'Bính' => array('Tý', 'Sửu', 'Dần', 'Mão'),
	            'Đinh' => array('Tuất', 'Hợi'),
	            'Mậu'  => array('Thân', 'Dậu'),
	            'Kỷ'   => array('Ngọ','Mùi'),
	            'Canh' => array('Thìn', 'Tỵ'),
	            'Tân'  => array('Tý', 'Sửu', 'Dần', 'Mão'),
	            'Nhâm' => array('Tuất', 'Hợi'),
	            'Quý'  => array('Thân', 'Dậu'),
	        );
	        $arr_can = $arr[$cannam];
	        if(in_array($chingay,$arr_can))
	            return true;
	        return false;
	    }

    ////


    /** HAM TRA VE DANH SACH CAC NGAY TOT THEO CONG VIEC DUA VAO THANG XEM, NAM XEM VA TUOI CUA NGUOI XEM 
	 *@ params $key : number
	 *return array if $key == null
	 *return string value of $array[$key] if $key != null
    **/
    public function dsNgaydepTheotuoi($thangxem, $namxem, $nguoixem, $congviec){
    	$congviec_digit = 0;
    	switch ($congviec) {
    		case 'ngaykhaitruong':
    			$congviec_digit = 15;
    			break;
    		case 'ngaymuaxe':
    			$congviec_digit = 18;
    			break;
    		case 'ngaymuanha':
    			$congviec_digit = 11;
    			break;
    		case 'ngaykethon':
    			$congviec_digit = 1;
    			break;
    		case 'nhaptrachnhamoi':
    			$congviec_digit = 5;
    			break;
    		case 'dongtho':
    			$congviec_digit = 4;
    			break;
    		case 'xuathanh':
    			$congviec_digit = 22;
    			break;

    		default:
    			$congviec_digit = 0;
    			break;
    	}

    	$canchinguoixem   = explode(' ', $nguoixem['namcanchi']);
    	$chinguoixem      = $canchinguoixem[1];
    	$arrchi           = array_flip($this->getChi());
    	$chinguoixem_digit= $arrchi[$chinguoixem];
    	$chixung          = ( $chinguoixem_digit + 6 > 12 ) 
    					  ? ( $chinguoixem_digit + 6 - 12 ) 
    					  : ( $chinguoixem_digit + 6 );
    	$chihop1          = ( $chinguoixem_digit + 4 > 12 ) 
    					  ? ( $chinguoixem_digit + 4 - 12 ) 
    					  : ( $chinguoixem_digit + 4 );
    	$chihop2          = ( $chinguoixem_digit - 4 < 1 ) 
    					  ? ( $chinguoixem_digit - 4 + 12 ) 
    					  : ( $chinguoixem_digit - 4 );

    	$duonglich        = array(1, $thangxem, $namxem);
    	$songay           = $this->CI->ngayamduong->get_songaytrongthang($duonglich);

    	$listDate         = array();
    	$list_xau         = array();

    	$list_1tot        = array();
    	
    	for($i= 1; $i <= $songay; $i++){
    		$duonglich  = array($i,$thangxem,$namxem);
            $amlich      = $this->CI->ngayamduong->get_amlich( $duonglich ); 
            $canchingay  = $this->CI->ngayamduong->get_canchi_ngay( $duonglich );

            $date_now           = strtotime($namxem.'/'.$thangxem.'/'.$i.' '.'6:6:6');
	        $date_old           = strtotime('2017/1/1 6:6:6');
	        $long_date          = $date_now-$date_old;
	        if ($long_date < 0) $long_date = 0 - $long_date;
	        $day_long_date      = (int)( $long_date / (60*60*24) );
	        $id_28sao           = ( $day_long_date + 11 ) % 28;
	        $id_28sao           = $id_28sao == 0 ? 28 : $id_28sao;

	        $canchithang            = $this->CI->ngayamduong->get_canchi_thang( $amlich );
	        $canchinam              = $this->CI->ngayamduong->get_canchi_nam( $amlich );
	        $xemngay['amlich']      = $amlich;
	        $xemngay['ngaythu']     = $this->CI->ngayamduong->get_ngaythu($duonglich);
	        $xemngay['duonglich']   = $duonglich;
	        $xemngay['ngaycanchi']  = $this->CI->ngayamduong->get_canchi_ngay( $duonglich, 'text' );
	        $xemngay['thangcanchi'] = $this->CI->ngayamduong->get_canchi_thang( $amlich, 'text'  );
	        $xemngay['namcanchi']   = $this->CI->ngayamduong->get_canchi_nam( $amlich, 'text'  );
	        $this->CI->lib_xemngay->xemngay_config($duonglich, $amlich, $canchingay);
	        $xemngay['ngay_hoang_dao'] = $this->CI->lib_xemngay->xacdinh_ngayhoangdao_totxau();
	        $xemngay['gio_hoang_dao_hac_dao']   = $this->xacdinh_giohoangdao( $canchingay['chi'] );

	        $xemngay['saocaiquan']  = $this->getNhithapbattu($id_28sao);

	        $sao_totcq = in_array( $congviec_digit, explode(',', $this->dl_nhithapbattu[$id_28sao]['congviectot']) );
	        $sao_xaucq = in_array( $congviec_digit, explode(',', $this->dl_nhithapbattu[$id_28sao]['congviecxau']) );
	        $sao_tot   = $this->dl_nhithapbattu[$id_28sao]['phanloai'] == 1;
	        $tranh_xung= $canchingay['chi'] != $chixung;

	        if( $canchingay['chi'] == $chixung )
	        	{
	        		$xemngay['loaingay']   = 'xấu';
	            	$list_xau[$i]          = $xemngay;
	        	}
	        // tranhngayky
	        	$arr_ngaycanchi = explode(' ',$xemngay['ngaycanchi']);
	        	$chingay        = $arr_ngaycanchi[1];
	        	$canngay        = $arr_ngaycanchi[0];
	        	$arr_namcanchi  = explode(' ', $xemngay['namcanchi']);
	        	$cannam         = $arr_namcanchi[0];

	        	$ky_1 = $this->tinhngay_nguyetki_tamnuong($xemngay['amlich'][0]);
	        	// $ky_2 = $this->tinhngay_thutu($chingay, $xemngay['amlich'][1]); k xet ky sat chu vi cong thuc co roi
	        	$ky_3 = $this->tinhngay_trungtang_trungphuc($canngay, $xemngay['amlich'][1]);
	        	$ky_4 = $this->tinhngay_duongcongluy($xemngay['amlich'][0],$xemngay['amlich'][1]);
	        	$ky_5 = $this->tinhngay_kimthanthatsat($chingay, $cannam);

		        if( $ky_1 || $ky_3 || $ky_4 || $ky_5 )
		        	{
		        		$xemngay['loaingay']   = 'xấu';
		            	$list_xau[$i]          = $xemngay;
		        	}

		        $c1 = $ky_1 == true ? '<span style="color:red;font-weight:bold;">bỏ vì </span>tam nương ' : '';
		        $c3 = $ky_3 == true ? '<span style="color:red;font-weight:bold;">bỏ vì </span>trùng tang ' :'';
		        $c4 = $ky_4 == true ? '<span style="color:red;font-weight:bold;">bỏ vì </span>dương công lụy ' : '';
		        $c5 = $ky_5 == true ? '<span style="color:red;font-weight:bold;">bỏ vì </span>kim thần thất sát ' : '';

	        // end tranhngayky

		    @$ngaythongthu  = $this->dl_thongthu[ $xemngay['amlich'][1] ][ $canchingay['chi'] ];
	    	if ( isset( $ngaythongthu ) ) {
	    		$mangCV = explode(',', $ngaythongthu['congviec']);
	    		if ( in_array($congviec_digit, $mangCV) ) {
		    		//la ngay dep theo thong thu
					$xemngay['loaingay']   = 'tốt';
		    		$list_1tot[$i]         = $xemngay;

		    		//ngay dep tt + tam hop => rat tot
		    		if ( $canchingay['chi'] == $chihop1 || $canchingay['chi'] == $chihop2 )
			            {
			            	$xemngay['loaingay']    = 'rất tốt';
			            	$list_1tot[$i]          = $xemngay;
			            }

			        // 2.ngaydep theo nhithapbattu
			        if( $sao_xaucq)
				        {
				        	$xemngay['loaingay']       = 'xấu';
				            $list_xau[$i]              = $xemngay;
				        }
				    elseif( $sao_totcq && $sao_tot && !isset($list_rattot[$i]))
			            {	
			            	if( isset($list_1tot[$i]) )
			            		{
			            			$xemngay['loaingay']         = 'rất tốt';
						            $list_1tot[$i]               = $xemngay;
			            		}
			        	}

			        // 3.ngaydep theo canchi
		    	    if (isset($this->dl_ngaycanchi[$congviec_digit])){	
		    			$arr_canchi_digit         = array_flip($this->getLucthaphoagiap());
		    			$canchi_digit             = $arr_canchi_digit[$xemngay['ngaycanchi']];
		    			$ngaydepcc                = in_array($canchi_digit, explode(',', $this->dl_ngaycanchi[$congviec_digit]));
		    			if ($ngaydepcc && $tranh_xung && !isset($list_rattot[$i]) )
			    			{
			    				if( isset($list_1tot[$i]) )
				    				{
				    					$xemngay['loaingay']         = 'rất tốt';
							            $list_1tot[$i]             = $xemngay;
				    				}
			    			}
		    		}

		    		// khong lay ngay co canchi trung voi canchi nguoi xem
			        	$txt_chingay  = explode(' ', $xemngay['ngaycanchi']);
			        	$txt_chinguoi = explode(' ', $nguoixem['namcanchi']);
			        	if ( $txt_chingay[1] == $txt_chinguoi[1] ) {
			        		unset($list_1tot[$i]);
			        	}
				    // end khong lay ngay co canchi trung voi canchi nguoi xem
	    		}
	    	}

    	}
    	foreach ($list_xau as $key => $value) {
    		if(isset($list_1tot[$key]))
    			unset($list_1tot[$key]);
    	}

    	$listDate['tot'] = $list_1tot;
    	$listDate['xau'] = $list_xau;
        return $listDate;
    }
}